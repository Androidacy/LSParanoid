name: Android CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-large

    steps:
    - uses: actions/checkout@v4
    - name: set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Setup gradle
      uses: gradle/actions/setup-gradle@v4
      with:
        gradle-version: '8.14.3'
        cache-cleanup: 'always'
        build-scan-publish: true
        build-scan-terms-of-use-url: "https://gradle.com/help/legal-terms-of-use"
        build-scan-terms-of-use-agree: "yes"
        cache-encryption-key: ${{ secrets.GRADLE_ENCRYPTION_KEY }}
    
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build and publish to Maven Local
      run: ./gradlew build test publishToMavenLocal

    - name: Build samples
      run: |
          cd samples
          ./gradlew :application:assembleRelease :application-global-obfuscate:assembleRelease :library:assembleRelease :library-may-obfuscate:assembleRelease :library-obfuscate:assembleRelease
      
